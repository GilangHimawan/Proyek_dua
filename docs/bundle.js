(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},59:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(601),a=n.n(o),r=n(314),i=n.n(r)()(a());i.push([e.id,"* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Roboto', sans-serif;\n    background-color: #f4f4f4;\n}\n\n#app {\n    max-width: 1000px;\n    margin: 0 auto;\n    padding: 20px;\n}\n\nnav {\n    background-color: #007BFF;\n    padding: 10px;\n    text-align: center;\n}\n\nnav a {\n    color: white;\n    margin: 0 15px;\n    text-decoration: none;\n    font-size: 18px;\n}\n\nnav a:hover {\n    text-decoration: underline;\n}\n\nmain {\n    padding: 20px;\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: opacity 0.3s ease-in-out;\n}\n\nmain.hidden {\n    opacity: 0;\n}\n\n#loader {\n    display: none;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #3498db;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n    animation: spin 1s linear infinite;\n    margin: 1rem auto;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\nform input,\nform button,\nform textarea {\n    width: 100%;\n    padding: 12px;\n    margin: 10px 0;\n    border-radius: 5px;\n    border: 1px solid #ddd;\n}\n\nform textarea {\n    height: 150px;\n    resize: none;\n}\n\nform button {\n    background-color: #007BFF;\n    color: white;\n    cursor: pointer;\n}\n\nform button:hover {\n    background-color: #0056b3;\n}\n\nform input[type=\"file\"] {\n    background-color: #f9f9f9;\n    padding: 8px;\n    border-radius: 5px;\n}\n\nbutton {\n    background-color: #ccc;\n    border: none;\n    padding: 8px 15px;\n    margin-top: 10px;\n    cursor: pointer;\n}\n\nbutton:hover {\n    background-color: #aaa;\n}\n\n.skip-link {\n    position: absolute;\n    top: -40px;\n    left: 0;\n    background: #000;\n    color: #fff;\n    padding: 8px;\n    z-index: 1000;\n    transition: top 0.3s;\n}\n\n.skip-link:focus {\n    top: 0;\n}\n\n.bookmark-button {\n    background-color: #FFCA28;\n    border: none;\n    padding: 8px 15px;\n    cursor: pointer;\n    border-radius: 5px;\n    font-size: 16px;\n}\n\n.bookmark-button:hover {\n    background-color: #FFB300;\n}\n\n.bookmark-button.active {\n    background-color: #FF8F00;\n    color: white;\n}\n\n@media (max-width: 768px) {\n    nav a {\n        font-size: 14px;\n    }\n\n    main {\n        padding: 10px;\n    }\n\n    .bookmark-button {\n        padding: 6px 12px;\n        font-size: 14px;\n    }\n}\n",""]);const s=i},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},i=[],s=0;s<e.length;s++){var c=e[s],d=o.base?c[0]+o.base:c[0],l=r[d]||0,u="".concat(d," ").concat(l);r[d]=l+1;var p=n(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var g=a(m,o);o.byIndex=s,t.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var r=o(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var c=o(e,a),d=0;d<r.length;d++){var l=n(r[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}r=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,a,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(i[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);o&&i[l[0]]||(void 0!==r&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=r),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),a&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=a):l[4]="".concat(a)),t.push(l))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;let o=null;function a(){return o||(o=new Promise(((e,t)=>{const n=indexedDB.open("storyAppDB",1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("stories")||t.createObjectStore("stories",{keyPath:"id"})},n.onsuccess=()=>e(n.result),n.onerror=e=>t(e)})),o)}function r(e){const t=document.getElementById("stories-list");t&&(t.innerHTML=e.map((e=>`\n    <div style="padding: 10px; margin-bottom: 10px; background: #f9f9f9; border-radius: 8px;">\n      <h3 style="margin: 0 0 5px;">${e.name}</h3>\n      <p style="margin: 0 0 10px;">${e.description}</p>\n      <img src="${e.photoUrl}" alt="story image" style="max-width: 100%; height: auto; border-radius: 4px; margin-bottom: 10px;" />\n      <p style="font-size: 0.9em; color: #555;">Lat: ${e.lat??"-"}, Lon: ${e.lon??"-"}</p>\n    </div>\n  `)).join(""))}function i(){const e=localStorage.getItem("token"),t=document.getElementById("logout-button"),n=document.querySelector('nav a[href="#login"]'),o=document.querySelector('nav a[href="#register"]');t&&(t.style.display=e?"inline-block":"none"),n&&(n.style.display=e?"none":"inline-block"),o&&(o.style.display=e?"none":"inline-block")}function s(){const e=document.getElementById("loader");e&&(e.style.display="block")}function c(){const e=document.getElementById("loader");e&&(e.style.display="none")}const d=document.getElementById("main-content");function l(){if(!d)return;d.innerHTML='\n    <h2>Home</h2>\n    <button id="add-story-btn">Tambah Cerita</button>\n    <div>\n      <button id="go-to-bookmark">📑 Bookmark</button>\n    </div>\n    <div>\n      <button id="toggle-notif">Aktifkan Notifikasi</button>\n    </div>\n    <div id="stories-list"></div>\n    <button id="logout-button" style="display: none;">Logout</button>\n  ',s(),async function(){const e=localStorage.getItem("token");if(!e)return alert("Login dulu"),void(location.hash="#login");try{const n=await fetch("https://story-api.dicoding.dev/v1/stories",{headers:{Authorization:`Bearer ${e}`}}),o=await n.json();o.error?"Token is invalid or expired"===o.message?(alert("Sesi login habis, silakan login ulang."),localStorage.removeItem("token"),location.hash="#login"):alert("Gagal mengambil cerita"):(await async function(){try{const e=(await a()).transaction("stories","readwrite").objectStore("stories").clear();return new Promise(((t,n)=>{e.onsuccess=()=>t(),e.onerror=()=>n(e.error)}))}catch(e){console.error("Gagal menghapus cerita dari DB:",e)}}(),await(t=o.listStory,async function(e){try{const t=(await a()).transaction("stories","readwrite"),n=t.objectStore("stories");return e.forEach((e=>n.put(e))),new Promise(((e,n)=>{t.oncomplete=()=>{console.log("Cerita berhasil disimpan ke DB."),e()},t.onerror=()=>n(t.error)}))}catch(e){console.error("Gagal menyimpan cerita ke DB:",e)}}(t)),r(o.listStory))}catch(e){console.warn("Gagal ambil data online, mencoba dari cache:",e);const t=await async function(){try{const e=(await a()).transaction("stories","readonly").objectStore("stories").getAll();return new Promise(((t,n)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)}))}catch(e){return console.error("Gagal memuat cerita dari DB:",e),[]}}();t.length>0?r(t):alert("Tidak ada cerita di cache.")}var t}(),i(),c(),document.getElementById("add-story-btn")?.addEventListener("click",(()=>{location.hash="#add"})),document.getElementById("go-to-bookmark")?.addEventListener("click",(()=>{location.hash="#draft"})),document.getElementById("logout-button")?.addEventListener("click",(()=>{localStorage.removeItem("token"),location.hash="#login"}));const e=document.getElementById("toggle-notif");async function t(){const t="true"===localStorage.getItem("pushSubscribed");e.textContent=t?"Nonaktifkan Notifikasi":"Aktifkan Notifikasi"}e?.addEventListener("click",(async()=>{try{"true"===localStorage.getItem("pushSubscribed")?await async function(){const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();if(t){await t.unsubscribe();const e=localStorage.getItem("token"),n=await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({endpoint:t.endpoint})});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal melakukan unsubscribe")}}localStorage.setItem("pushSubscribed","false")}():await async function(){if("granted"!==await Notification.requestPermission())throw new Error("Izin notifikasi ditolak.");const e=await navigator.serviceWorker.ready;let t=await e.pushManager.getSubscription();if(!t){const n=function(){const e=("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"+"=".repeat(1)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e);return new Uint8Array([...t].map((e=>e.charCodeAt(0))))}();t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})}const n={endpoint:t.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(t.getKey("p256dh")))),auth:btoa(String.fromCharCode(...new Uint8Array(t.getKey("auth"))))}},o=localStorage.getItem("token"),a=await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const e=await a.json();throw new Error(e.message||"Gagal melakukan subscribe")}localStorage.setItem("pushSubscribed","true")}(),await t()}catch(e){alert("Gagal mengatur notifikasi: "+e.message)}})),t()}function u(){const e=document.getElementById("video");document.getElementById("camera-container").style.display="block",navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{e.srcObject=t,e.play()})).catch((e=>alert("Tidak bisa mengakses kamera: "+e)))}function p(){const e=document.getElementById("video"),t=document.getElementById("canvas"),n=document.getElementById("story-photo-base64");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height);const o=t.toDataURL("image/png");n.value=o;const a=document.createElement("img");a.src=o,a.style.maxWidth="200px",document.getElementById("camera-container").appendChild(a),e.srcObject.getTracks().forEach((e=>e.stop())),e.style.display="none"}function m(){document.getElementById("story-photo").click()}const g=(e,t)=>t.some((t=>e instanceof t));let f,y;const h=new WeakMap,b=new WeakMap,v=new WeakMap;let k={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return I(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function w(e){k=e(k)}function x(e){return"function"==typeof e?(t=e,(y||(y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(E(this),e),I(this.request)}:function(...e){return I(t.apply(E(this),e))}):(e instanceof IDBTransaction&&function(e){if(h.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",r),e.removeEventListener("abort",r)},a=()=>{t(),o()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",r),e.addEventListener("abort",r)}));h.set(e,t)}(e),g(e,f||(f=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,k):e);var t}function I(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",r)},a=()=>{t(I(e.result)),o()},r=()=>{n(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",r)}));return v.set(t,e),t}(e);if(b.has(e))return b.get(e);const t=x(e);return t!==e&&(b.set(e,t),v.set(t,e)),t}const E=e=>v.get(e),B=["get","getKey","getAll","getAllKeys","count"],S=["put","add","delete","clear"],D=new Map;function T(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(D.get(t))return D.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,a=S.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!a&&!B.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,a?"readwrite":"readonly");let i=r.store;return o&&(i=i.index(t.shift())),(await Promise.all([i[n](...t),a&&r.done]))[0]};return D.set(t,r),r}w((e=>({...e,get:(t,n,o)=>T(t,n)||e.get(t,n,o),has:(t,n)=>!!T(t,n)||e.has(t,n)})));const C=["continue","continuePrimaryKey","advance"],P={},A=new WeakMap,j=new WeakMap,M={get(e,t){if(!C.includes(t))return e[t];let n=P[t];return n||(n=P[t]=function(...e){A.set(this,j.get(this)[t](...e))}),n}};async function*O(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,M);for(j.set(n,t),v.set(n,E(t));t;)yield n,t=await(A.get(n)||t.continue()),A.delete(n)}function F(e,t){return t===Symbol.asyncIterator&&g(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&g(e,[IDBIndex,IDBObjectStore])}w((e=>({...e,get:(t,n,o)=>F(t,n)?O:e.get(t,n,o),has:(t,n)=>F(t,n)||e.has(t,n)})));const $="drafts";function N(){return new Promise(((e,t)=>{const n=indexedDB.open("storyDrafts",1);n.onerror=()=>t("Gagal membuka IndexedDB"),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains($)||t.createObjectStore($,{keyPath:"id",autoIncrement:!0})}}))}async function z(e){const t=(await N()).transaction($,"readwrite");return t.objectStore($).delete(e),new Promise(((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)}))}async function H(){const e=document.getElementById("main-content");if(!e)return;i();const t=await async function(){const e=(await N()).transaction($,"readonly").objectStore($).getAll();return new Promise(((t,n)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)}))}();0!==t.length?(e.innerHTML=`\n    <h2>Draft Cerita</h2>\n    ${t.map((e=>`\n      <div style="border: 1px solid #ccc; margin-bottom: 10px; padding: 10px;">\n        <p><strong>Deskripsi:</strong> ${e.description}</p>\n        ${e.base64?`<img src="${e.base64}" style="max-width: 200px;" alt="Preview Foto" />`:""}\n        <p>Lokasi: Lat ${e.lat??"-"}, Lon ${e.lon??"-"}</p>\n        <button class="send-draft-btn" data-id="${e.id}">📤 Kirim</button>\n        <button class="delete-draft-btn" data-id="${e.id}">🗑 Hapus</button>\n      </div>\n    `)).join("")}\n    <button id="back-to-home">⬅️ Kembali ke Beranda</button>\n  `,e.addEventListener("click",(async e=>{const n=e.target.closest(".send-draft-btn"),o=e.target.closest(".delete-draft-btn");if(n){const e=Number(n.dataset.id),o=t.find((t=>t.id===e));if(!o)return;try{const t=localStorage.getItem("token");if(!t)return alert("Sesi login berakhir. Silakan login kembali."),void(location.hash="#login");const n=new FormData;if(n.append("description",o.description),!o.base64)return void alert("Foto tidak ditemukan di draft.");{const e=await fetch(o.base64),t=await e.blob();n.append("photo",t,"photo.jpg")}o.lat&&o.lon&&(n.append("lat",o.lat),n.append("lon",o.lon));const a=await fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:n}),r=await a.json();if(!a.ok)throw new Error(r.message||"Gagal mengirim cerita");await z(e),alert("Cerita berhasil dikirim!"),H()}catch(e){alert("Gagal mengirim cerita: "+e.message)}}if(o){const e=Number(o.dataset.id);await z(e),H()}})),document.getElementById("back-to-home")?.addEventListener("click",(()=>{location.hash="#home"}))):e.innerHTML="<p>Belum ada draft cerita.</p>"}function R(){switch(location.hash||"#login"){case"#login":d&&(d.innerHTML='\n    <h2>Login</h2>\n    <form id="login-form">\n      <label for="email">Email:</label>\n      <input type="email" id="email" required />\n      <label for="password">Password:</label>\n      <input type="password" id="password" required />\n      <button type="submit">Login</button>\n    </form>\n  ',i(),document.getElementById("login-form")?.addEventListener("submit",(async e=>{e.preventDefault();const t=e.target.email.value,n=e.target.password.value;s(),await async function(e,t){try{const n=await fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await n.json();o.error?alert("Login gagal: "+o.message):(localStorage.setItem("token",o.loginResult.token),location.hash="home")}catch(e){alert("Terjadi kesalahan: "+e.message)}}(t,n),c()})));break;case"#home":i(),l();break;case"#register":d&&(d.innerHTML=' \n    <h2>Register</h2>\n    <form id="register-form">\n      <label for="name">Nama:</label>\n      <input type="text" id="name" required />\n      <label for="email">Email:</label>\n      <input type="email" id="email" required />\n      <label for="password">Password:</label>\n      <input type="password" id="password" required />\n      <button type="submit">Register</button>\n    </form>\n  ',document.getElementById("register-form")?.addEventListener("submit",(async e=>{e.preventDefault();const t=e.target.name.value,n=e.target.email.value,o=e.target.password.value;s(),await async function(e,t,n){try{const o=await fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})}),a=await o.json();a.error?alert("Registrasi gagal: "+a.message):(alert("Registrasi berhasil! Silakan login."),location.hash="login")}catch(e){alert("Terjadi kesalahan: "+e.message)}}(t,n,o),c()})));break;case"#add":!function(){const e=document.getElementById("main-content");i(),e?(e.innerHTML='\n    <h2>Add Story</h2>\n    <form id="story-form">\n      <label>Description:</label>\n      <textarea id="story-description" required></textarea>\n\n      <label>Photo:</label>\n      <button type="button" id="choose-photo">Choose from Device</button>\n      <button type="button" id="open-camera">Take from Camera</button>\n\n      <div id="camera-container" style="display:none;">\n        <video id="video" width="320" height="240" autoplay></video>\n        <button type="button" id="capture-btn">Capture Photo</button>\n        <canvas id="canvas" style="display:none;"></canvas>\n      </div>\n\n      <input type="file" id="story-photo" accept="image/*" style="display:none;" />\n      <input type="hidden" id="story-photo-base64" />\n      <input type="hidden" id="story-lat" />\n      <input type="hidden" id="story-lon" />\n      <div id="map" style="height:300px;margin-top:10px;"></div>\n\n      <button type="submit">Submit Story</button>\n      <button type="button" id="save-draft-btn">Save as Draft</button>\n    </form>\n  ',function(){const e=document.getElementById("map"),t=L.map(e).setView([-2.5,117],4),n=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}),o=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"});n.addTo(t);const r={OpenStreetMap:n,"CartoDB Positron":o,"CartoDB Dark":a};let i;L.control.layers(r).addTo(t),navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const n=e.coords.latitude,o=e.coords.longitude;t.setView([n,o],13),document.getElementById("story-lat").value=n.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i=L.marker([n,o]).addTo(t).bindPopup("Lokasi Anda").openPopup()}),(()=>{alert("Tidak bisa mendapatkan lokasi.")})),t.on("click",(function(e){const{lat:n,lng:o}=e.latlng;document.getElementById("story-lat").value=n.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i?i.setLatLng([n,o]):i=L.marker([n,o]).addTo(t),i.bindPopup(`Lokasi dipilih:<br>${n.toFixed(6)}, ${o.toFixed(6)}`).openPopup()}))}(),document.getElementById("choose-photo").addEventListener("click",m),document.getElementById("open-camera").addEventListener("click",u),document.getElementById("capture-btn").addEventListener("click",p),document.getElementById("story-form").addEventListener("submit",(async e=>{e.preventDefault();const t=localStorage.getItem("token");if(!t)return alert("Session expired, please log in again."),void(location.hash="#login");const n=document.getElementById("story-description").value,o=document.getElementById("story-photo").files[0],a=document.getElementById("story-photo-base64").value,r=document.getElementById("story-lat").value,i=document.getElementById("story-lon").value,s=new FormData;if(s.append("description",n),o)s.append("photo",o);else{if(!a)return void alert("Please choose or take a photo.");{const e=function(e){const t=e.split(";base64,"),n=t[0].split(":")[1],o=atob(t[1]),a=[];for(let e=0;e<o.length;e++)a.push(o.charCodeAt(e));return new Blob([new Uint8Array(a)],{type:n})}(a);s.append("photo",e,"camera-photo.png")}}r&&i&&(s.append("lat",r),s.append("lon",i));try{const e=await fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s}),n=await e.json();n.error?alert(n.message||"Failed to submit!"):(alert("Story successfully submitted!"),location.hash="#home")}catch(e){alert("Error: "+e.message)}})),document.getElementById("story-photo").addEventListener("change",(function(){const e=this.files[0];if(!e)return;const t=new FileReader;t.onload=function(e){document.getElementById("story-photo-base64").value=e.target.result},t.readAsDataURL(e)})),document.getElementById("save-draft-btn").addEventListener("click",(async()=>{const e=document.getElementById("story-description").value,t=document.getElementById("story-photo-base64").value,n=document.getElementById("story-lat").value,o=document.getElementById("story-lon").value;if(!e)return alert("Description must be filled out.");await async function(e){const t=(await N()).transaction($,"readwrite"),n=t.objectStore($),{id:o,...a}=e;return n.add(a),new Promise(((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)}))}({description:e,base64:t,lat:n,lon:o,createdAt:(new Date).toISOString()}),alert("Saved as draft!"),location.hash="#home"}))):console.error('Element with ID "main-content" not found')}();break;case"#draft":H();break;default:!function(){const e=document.getElementById("main-content");e&&(e.innerHTML='\n    <h2>404 - Halaman Tidak Ditemukan</h2>\n    <p>Halaman yang Anda cari tidak tersedia.</p>\n    <a href="#home">Kembali ke Beranda</a>\n  ')}()}}var q=n(72),G=n.n(q),U=n(825),K=n.n(U),W=n(659),_=n.n(W),J=n(56),V=n.n(J),Q=n(540),Y=n.n(Q),X=n(113),Z=n.n(X),ee=n(59),te={};te.styleTagTransform=Z(),te.setAttributes=V(),te.insert=_().bind(null,"head"),te.domAPI=K(),te.insertStyleElement=Y(),G()(ee.A,te),ee.A&&ee.A.locals&&ee.A.locals,document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("hashchange",R),R()}))})();