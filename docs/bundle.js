(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},59:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(601),a=n.n(o),r=n(314),i=n.n(r)()(a());i.push([t.id,"* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Roboto', sans-serif;\n    background-color: #f4f4f4;\n}\n\n#app {\n    max-width: 1000px;\n    margin: 0 auto;\n    padding: 20px;\n}\n\nnav {\n    background-color: #007BFF;\n    padding: 10px;\n    text-align: center;\n}\n\nnav a {\n    color: white;\n    margin: 0 15px;\n    text-decoration: none;\n    font-size: 18px;\n}\n\nnav a:hover {\n    text-decoration: underline;\n}\n\nmain {\n    padding: 20px;\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: opacity 0.3s ease-in-out;\n}\n\nmain.hidden {\n    opacity: 0;\n}\n\n#loader {\n    display: none;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #3498db;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n    animation: spin 1s linear infinite;\n    margin: 1rem auto;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\nform input,\nform button,\nform textarea {\n    width: 100%;\n    padding: 12px;\n    margin: 10px 0;\n    border-radius: 5px;\n    border: 1px solid #ddd;\n}\n\nform textarea {\n    height: 150px;\n    resize: none;\n}\n\nform button {\n    background-color: #007BFF;\n    color: white;\n    cursor: pointer;\n}\n\nform button:hover {\n    background-color: #0056b3;\n}\n\nform input[type=\"file\"] {\n    background-color: #f9f9f9;\n    padding: 8px;\n    border-radius: 5px;\n}\n\nbutton {\n    background-color: #ccc;\n    border: none;\n    padding: 8px 15px;\n    margin-top: 10px;\n    cursor: pointer;\n}\n\nbutton:hover {\n    background-color: #aaa;\n}\n\n.skip-link {\n    position: absolute;\n    top: -40px;\n    left: 0;\n    background: #000;\n    color: #fff;\n    padding: 8px;\n    z-index: 1000;\n    transition: top 0.3s;\n}\n\n.skip-link:focus {\n    top: 0;\n}\n\n.bookmark-button {\n    background-color: #FFCA28;\n    border: none;\n    padding: 8px 15px;\n    cursor: pointer;\n    border-radius: 5px;\n    font-size: 16px;\n}\n\n.bookmark-button:hover {\n    background-color: #FFB300;\n}\n\n.bookmark-button.active {\n    background-color: #FF8F00;\n    color: white;\n}\n\n@media (max-width: 768px) {\n    nav a {\n        font-size: 14px;\n    }\n\n    main {\n        padding: 10px;\n    }\n\n    .bookmark-button {\n        padding: 6px 12px;\n        font-size: 14px;\n    }\n}\n",""]);const s=i},72:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var r={},i=[],s=0;s<t.length;s++){var c=t[s],d=o.base?c[0]+o.base:c[0],l=r[d]||0,u="".concat(d," ").concat(l);r[d]=l+1;var p=n(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)e[p].references++,e[p].updater(m);else{var g=a(m,o);o.byIndex=s,e.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function a(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,a){var r=o(t=t||[],a=a||{});return function(t){t=t||[];for(var i=0;i<r.length;i++){var s=n(r[i]);e[s].references--}for(var c=o(t,a),d=0;d<r.length;d++){var l=n(r[d]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}r=c}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,a,r){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(i[c]=!0)}for(var d=0;d<t.length;d++){var l=[].concat(t[d]);o&&i[l[0]]||(void 0!==r&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=r),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),a&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=a):l[4]="".concat(a)),e.push(l))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(o){var a=e[o];if(void 0!==a)return a.exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;let o=null;function a(){return o||(o=new Promise(((t,e)=>{const n=indexedDB.open("storyAppDB",1);n.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains("stories")||e.createObjectStore("stories",{keyPath:"id"})},n.onsuccess=()=>t(n.result),n.onerror=t=>e(t)})),o)}function r(){const t=document.getElementById("subscribe-push-btn");if(!t)return;const e="true"===localStorage.getItem("pushSubscribed");t.textContent=e?"ðŸ”• Berhenti Langganan":"ðŸ”” Aktifkan Notifikasi"}let i=!1;function s(t){const e=document.getElementById("stories-list");if(!e)return;const n=JSON.parse(localStorage.getItem("userSubscriptions")||"{}");e.innerHTML=t.map((t=>{const e=!0===n[t.authorId];return`\n      <div style="padding:10px; margin-bottom:10px; background:#f9f9f9;">\n        <h3>${t.name}</h3>\n        <p>${t.description}</p>\n        <img src="${t.photoUrl}" style="max-width:200px;" alt="story">\n        <p>Lat: ${t.lat??"-"}, Lon: ${t.lon??"-"}</p>\n        <button \n          class="subscribe-user-btn" \n          data-author-id="${t.authorId}">\n          ${e?"ðŸ”• Unsubscribe ":"ðŸ”” Subscribe "}${t.name}\n        </button>\n      </div>\n    `})).join(""),i||(e.addEventListener("click",(async t=>{const e=t.target.closest(".subscribe-user-btn");if(!e)return;const n=e.dataset.authorId,o=JSON.parse(localStorage.getItem("userSubscriptions")||"{}"),a=!0===o[n];try{a?await async function(){const t=await navigator.serviceWorker.ready,e=await t.pushManager.getSubscription(),n=localStorage.getItem("token");if(e){await e.unsubscribe();const t=await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"DELETE",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({endpoint:e.endpoint})}),o=await t.json();if(!t.ok)throw new Error(o.message||"Gagal unsubscribe")}localStorage.setItem("pushSubscribed","false"),r()}():await async function(){const t=await navigator.serviceWorker.ready;if("granted"!==await Notification.requestPermission())throw new Error("Izin ditolak");let e=await t.pushManager.getSubscription();if(!e){const n=function(){const t=("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"+"=".repeat(1)).replace(/-/g,"+").replace(/_/g,"/"),e=atob(t);return new Uint8Array([...e].map((t=>t.charCodeAt(0))))}();e=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})}const n={endpoint:e.endpoint,keys:{p256dh:e.getKey("p256dh")?btoa(String.fromCharCode(...new Uint8Array(e.getKey("p256dh")))):"",auth:e.getKey("auth")?btoa(String.fromCharCode(...new Uint8Array(e.getKey("auth")))):""}},o=localStorage.getItem("token"),a=await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await a.json();if(!a.ok)throw new Error(i.message||"Gagal subscribe");localStorage.setItem("pushSubscribed","true"),r()}(),o[n]=!a,localStorage.setItem("userSubscriptions",JSON.stringify(o)),e.textContent=a?`ðŸ”” Subscribe ${e.textContent.split(" ").slice(1).join(" ")}`:`ðŸ”• Unsubscribe ${e.textContent.split(" ").slice(1).join(" ")}`}catch(t){console.error("Gagal (un)subscribe:",t),alert("Gagal memproses permintaan.")}})),i=!0)}function c(){const t=document.getElementById("loader");t&&(t.style.display="block")}function d(){const t=document.getElementById("loader");t&&(t.style.display="none")}const l=document.getElementById("main-content");function u(){l&&(l.innerHTML='\n    <h2>Home</h2>\n    <button id="add-story-btn">Tambah Cerita</button>\n    <div>\n    <button id="go-to-bookmark">ðŸ“‘ Bookmark</button>\n    </div>\n    <div id="stories-list"></div>\n    <button id="logout-button" style="display: none;">Logout</button>\n  ',c(),async function(){const t=localStorage.getItem("token");if(!t)return alert("Login dulu"),void(location.hash="#login");try{const n=await fetch("https://story-api.dicoding.dev/v1/stories",{headers:{Authorization:`Bearer ${t}`}}),o=await n.json();o.error?"Token is invalid or expired"===o.message?(alert("Sesi login habis, silakan login ulang."),localStorage.removeItem("token"),location.hash="#login"):alert("Gagal mengambil cerita"):(await async function(){try{const t=(await a()).transaction("stories","readwrite").objectStore("stories").clear();return new Promise(((e,n)=>{t.onsuccess=()=>e(),t.onerror=()=>n(t.error)}))}catch(t){console.error("Gagal menghapus cerita dari DB:",t)}}(),await(e=o.listStory,async function(t){try{const e=(await a()).transaction("stories","readwrite"),n=e.objectStore("stories");return t.forEach((t=>n.put(t))),new Promise(((t,n)=>{e.oncomplete=()=>{console.log("Cerita berhasil disimpan ke DB."),t()},e.onerror=()=>n(e.error)}))}catch(t){console.error("Gagal menyimpan cerita ke DB:",t)}}(e)),s(o.listStory))}catch(t){console.warn("Gagal ambil data online, mencoba dari cache:",t);const e=await async function(){try{const t=(await a()).transaction("stories","readonly").objectStore("stories").getAll();return new Promise(((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)}))}catch(t){return console.error("Gagal memuat cerita dari DB:",t),[]}}();e.length>0?s(e):alert("Tidak ada cerita di cache.")}var e}(),function(){const t=localStorage.getItem("token"),e=document.getElementById("logout-button"),n=document.querySelector('nav a[href="#login"]'),o=document.querySelector('nav a[href="#register"]');e&&(e.style.display=t?"inline-block":"none"),n&&(n.style.display=t?"none":"inline-block"),o&&(o.style.display=t?"none":"inline-block")}(),d(),document.getElementById("add-story-btn")?.addEventListener("click",(()=>{location.hash="#add"})),document.getElementById("go-to-bookmark").addEventListener("click",(()=>{location.hash="#draft"})),document.getElementById("logout-button")?.addEventListener("click",(()=>{localStorage.removeItem("token"),location.hash="login"})))}function p(){const t=document.getElementById("video");document.getElementById("camera-container").style.display="block",navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{t.srcObject=e,t.play()})).catch((t=>alert("Tidak bisa mengakses kamera: "+t)))}function m(){const t=document.getElementById("video"),e=document.getElementById("canvas"),n=document.getElementById("story-photo-base64");e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height);const o=e.toDataURL("image/png");n.value=o;const a=document.createElement("img");a.src=o,a.style.maxWidth="200px",document.getElementById("camera-container").appendChild(a),t.srcObject.getTracks().forEach((t=>t.stop())),t.style.display="none"}function g(){document.getElementById("story-photo").click()}async function b(){const t=document.getElementById("main-content");if(!t)return;const e=await async function(){const t=(await openDB()).transaction("drafts","readonly").objectStore("drafts").getAll();return new Promise(((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)}))}();0!==e.length?(t.innerHTML="<h2>Draft Cerita</h2>"+e.map((t=>`\n    <div style="border:1px solid #ccc; margin-bottom:10px; padding:10px;">\n      <p><strong>Deskripsi:</strong> ${t.description}</p>\n      ${t.photo?`<img src="${t.photo}" style="max-width:200px;" />`:""}\n      <p>Lokasi: Lat ${t.lat??"-"}, Lon ${t.lon??"-"}</p>\n      <button class="delete-draft-btn" data-id="${t.id}">ðŸ—‘ Hapus Draft</button>\n    </div>\n  `)).join(""),t.addEventListener("click",(async t=>{const e=t.target.closest(".delete-draft-btn");if(!e)return;const n=Number(e.dataset.id);await async function(t){const e=(await openDB()).transaction("drafts","readwrite");return e.objectStore("drafts").delete(t),new Promise(((t,n)=>{e.oncomplete=()=>t(),e.onerror=()=>n(e.error)}))}(n),b()}))):t.innerHTML="<p>Belum ada draft cerita.</p>"}function y(){switch(location.hash||"login"){case"#login":l&&(l.innerHTML='\n    <h2>Login</h2>\n    <form id="login-form">\n      <label for="email">Email:</label>\n      <input type="email" id="email" required />\n      <label for="password">Password:</label>\n      <input type="password" id="password" required />\n      <button type="submit">Login</button>\n    </form>\n  ',document.getElementById("login-form")?.addEventListener("submit",(async t=>{t.preventDefault();const e=t.target.email.value,n=t.target.password.value;c(),await async function(t,e){try{const n=await fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})}),o=await n.json();o.error?alert("Login gagal: "+o.message):(localStorage.setItem("token",o.loginResult.token),location.hash="home")}catch(t){alert("Terjadi kesalahan: "+t.message)}}(e,n),d()})));break;case"#home":u();break;case"#register":l&&(l.innerHTML=' \n    <h2>Register</h2>\n    <form id="register-form">\n      <label for="name">Nama:</label>\n      <input type="text" id="name" required />\n      <label for="email">Email:</label>\n      <input type="email" id="email" required />\n      <label for="password">Password:</label>\n      <input type="password" id="password" required />\n      <button type="submit">Register</button>\n    </form>\n  ',document.getElementById("register-form")?.addEventListener("submit",(async t=>{t.preventDefault();const e=t.target.name.value,n=t.target.email.value,o=t.target.password.value;c(),await async function(t,e,n){try{const o=await fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:e,password:n})}),a=await o.json();a.error?alert("Registrasi gagal: "+a.message):(alert("Registrasi berhasil! Silakan login."),location.hash="login")}catch(t){alert("Terjadi kesalahan: "+t.message)}}(e,n,o),d()})));break;case"#add":!function(){const t=document.getElementById("main-content");t?(t.innerHTML='\n    <h2>Tambah Cerita</h2>\n    <form id="story-form">\n      <label>Deskripsi:</label>\n      <textarea id="story-description" required></textarea>\n\n      <label>Foto:</label>\n      <button type="button" id="choose-photo">Pilih dari Perangkat</button>\n      <button type="button" id="open-camera">Ambil dari Kamera</button>\n\n      <div id="camera-container" style="display:none;">\n        <video id="video" width="320" height="240" autoplay></video>\n        <button type="button" id="capture-btn">Ambil Foto</button>\n        <canvas id="canvas" style="display:none;"></canvas>\n      </div>\n\n      <input type="file" id="story-photo" accept="image/*" style="display:none;" />\n      <input type="hidden" id="story-photo-base64" />\n      <input type="hidden" id="story-lat" />\n      <input type="hidden" id="story-lon" />\n      <div id="map" style="height:300px;margin-top:10px;"></div>\n\n      <button type="submit">Kirim Cerita</button>\n      <button type="button" id="save-draft-btn">Simpan Sebagai Draft</button>\n    </form>\n  ',function(){const t=document.getElementById("map"),e=L.map(t).setView([-2.5,117],4),n=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}),o=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"});n.addTo(e);const r={OpenStreetMap:n,"CartoDB Positron":o,"CartoDB Dark":a};let i;L.control.layers(r).addTo(e),navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const n=t.coords.latitude,o=t.coords.longitude;e.setView([n,o],13),document.getElementById("story-lat").value=n.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i=L.marker([n,o]).addTo(e).bindPopup("Lokasi Anda").openPopup()}),(()=>{alert("Tidak bisa mendapatkan lokasi.")})),e.on("click",(function(t){const{lat:n,lng:o}=t.latlng;document.getElementById("story-lat").value=n.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i?i.setLatLng([n,o]):i=L.marker([n,o]).addTo(e),i.bindPopup(`Lokasi dipilih:<br>${n.toFixed(6)}, ${o.toFixed(6)}`).openPopup()}))}(),document.getElementById("choose-photo").addEventListener("click",g),document.getElementById("open-camera").addEventListener("click",p),document.getElementById("capture-btn").addEventListener("click",m),document.getElementById("story-form").addEventListener("submit",(async t=>{t.preventDefault();const e=localStorage.getItem("token");if(!e)return alert("Sesi habis, silakan login lagi."),void(location.hash="#login");const n=document.getElementById("story-description").value,o=document.getElementById("story-photo").files[0],a=document.getElementById("story-photo-base64").value,r=document.getElementById("story-lat").value,i=document.getElementById("story-lon").value,s=new FormData;if(s.append("description",n),o)s.append("photo",o);else{if(!a)return void alert("Silakan pilih atau ambil foto.");{const t=function(t){const e=t.split(";base64,"),n=e[0].split(":")[1],o=atob(e[1]),a=[];for(let t=0;t<o.length;t++)a.push(o.charCodeAt(t));return new Blob([new Uint8Array(a)],{type:n})}(a);s.append("photo",t,"camera-photo.png")}}r&&i&&(s.append("lat",r),s.append("lon",i)),document.getElementById("save-draft-btn").addEventListener("click",(async()=>{const t=document.getElementById("story-description").value,e=(document.getElementById("story-photo").files[0],document.getElementById("story-photo-base64").value),n=document.getElementById("story-lat").value,o=document.getElementById("story-lon").value;if(!t)return alert("Deskripsi harus diisi.");await saveDraft({description:t,base64:e,lat:n,lon:o,createdAt:(new Date).toISOString()}),alert("Disimpan sebagai draft!")}));try{const t=await fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:s}),n=await t.json();n.error?alert(n.message||"Gagal mengirim!"):(alert("Cerita berhasil dikirim!"),location.hash="#home")}catch(t){alert("Error: "+t.message)}}))):console.error('Elemen dengan ID "main-content" tidak ditemukan')}();break;case"#draft":b();break;default:location.hash="login"}}var h=n(72),f=n.n(h),v=n(825),k=n.n(v),w=n(659),x=n.n(w),E=n(56),I=n.n(E),S=n(540),B=n.n(S),C=n(113),T=n.n(C),A=n(59),D={};D.styleTagTransform=T(),D.setAttributes=I(),D.insert=x().bind(null,"head"),D.domAPI=k(),D.insertStyleElement=B(),f()(A.A,D),A.A&&A.A.locals&&A.A.locals,document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("hashchange",y),y()}))})();