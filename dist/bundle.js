(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},59:(n,e,t)=>{t.d(e,{A:()=>s});var o=t(601),a=t.n(o),r=t(314),i=t.n(r)()(a());i.push([n.id,"\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n  \n  body {\n    font-family: 'Roboto', sans-serif;\n    background-color: #f4f4f4;\n  }\n  \n  #app {\n    max-width: 1000px;\n    margin: 0 auto;\n    padding: 20px;\n  }\n  \n  nav {\n    background-color: #007BFF;\n    padding: 10px;\n    text-align: center;\n  }\n  \n  nav a {\n    color: white;\n    margin: 0 15px;\n    text-decoration: none;\n    font-size: 18px;\n  }\n  \n  nav a:hover {\n    text-decoration: underline;\n  }\n  \n  main {\n    padding: 20px;\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: opacity 0.3s ease-in-out;\n  }\n  \n  main.hidden {\n    opacity: 0;\n  }\n  \n  form input,\n  form button,\n  form textarea {\n    width: 100%;\n    padding: 12px;\n    margin: 10px 0;\n    border-radius: 5px;\n    border: 1px solid #ddd;\n  }\n  \n  form textarea {\n    height: 150px;\n    resize: none;\n  }\n  \n  form button {\n    background-color: #007BFF;\n    color: white;\n    cursor: pointer;\n  }\n  \n  form button:hover {\n    background-color: #0056b3;\n  }\n  \n  form input[type=\"file\"] {\n    background-color: #f9f9f9;\n    padding: 8px;\n    border-radius: 5px;\n  }\n  \n  button {\n    background-color: #ccc;\n    border: none;\n    padding: 8px 15px;\n    margin-top: 10px;\n    cursor: pointer;\n  }\n  \n  button:hover {\n    background-color: #aaa;\n  }\n  \n  .skip-link {\n    position: absolute;\n    top: -40px;\n    left: 0;\n    background: #000;\n    color: #fff;\n    padding: 8px;\n    z-index: 1000;\n    transition: top 0.3s;\n  }\n  .skip-link:focus {\n    top: 0;\n  }\n  \n  \n  @media (max-width: 768px) {\n    nav a {\n      font-size: 14px;\n    }\n  \n    main {\n      padding: 10px;\n    }\n  }\n  ",""]);const s=i},72:n=>{var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var r={},i=[],s=0;s<n.length;s++){var d=n[s],l=o.base?d[0]+o.base:d[0],c=r[l]||0,p="".concat(l," ").concat(c);r[l]=c+1;var u=t(p),m={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var g=a(m,o);o.byIndex=s,e.splice(s,0,{identifier:p,updater:g,references:1})}i.push(p)}return i}function a(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,a){var r=o(n=n||[],a=a||{});return function(n){n=n||[];for(var i=0;i<r.length;i++){var s=t(r[i]);e[s].references--}for(var d=o(n,a),l=0;l<r.length;l++){var c=t(r[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=d}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,o,a,r){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var l=0;l<n.length;l++){var c=[].concat(n[l]);o&&i[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),e.push(c))}},e}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,a&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(o){var a=e[o];if(void 0!==a)return a.exports;var r=e[o]={id:o,exports:{}};return n[o](r,r.exports,t),r.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var o=t(72),a=t.n(o),r=t(825),i=t.n(r),s=t(659),d=t.n(s),l=t(56),c=t.n(l),p=t(540),u=t.n(p),m=t(113),g=t.n(m),h=t(59),f={};f.styleTagTransform=g(),f.setAttributes=c(),f.insert=d().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=u(),a()(h.A,f),h.A&&h.A.locals&&h.A.locals;const y=document.getElementById("main-content");function b(){const n=location.hash.substring(1);"home"===n?v():"login"===n?(y.innerHTML='\n      <h2>Login</h2>\n      <form id="login-form">\n        <label for="email">Email:</label>\n        <input type="email" id="email" required />\n  \n        <label for="password">Password:</label>\n        <input type="password" id="password" required />\n  \n        <button type="submit">Login</button>\n      </form>\n    ',document.getElementById("login-form").addEventListener("submit",(function(n){n.preventDefault();const e=document.getElementById("email").value,t=document.getElementById("password").value;fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((n=>n.json())).then((n=>{n.error?alert("Login gagal: "+n.message):(localStorage.setItem("token",n.loginResult.token),location.hash="home")})).catch((n=>alert("Terjadi kesalahan: "+n)))}))):"register"===n?(y.innerHTML='\n      <h2>Register</h2>\n      <form id="register-form">\n        <label for="name">Nama:</label>\n        <input type="text" id="name" required />\n  \n        <label for="email">Email:</label>\n        <input type="email" id="email" required />\n  \n        <label for="password">Password:</label>\n        <input type="password" id="password" required />\n  \n        <button type="submit">Register</button>\n      </form>\n    ',document.getElementById("register-form").addEventListener("submit",(function(n){n.preventDefault();const e=document.getElementById("name").value,t=document.getElementById("email").value,o=document.getElementById("password").value;fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:o})}).then((n=>n.json())).then((n=>{n.error?alert("Registrasi gagal: "+n.message):(alert("Registrasi berhasil! Silakan login."),location.hash="login")})).catch((n=>alert("Terjadi kesalahan: "+n)))}))):location.hash="home"}function v(){y.innerHTML='\n    <h2>Home</h2>\n    <button onclick="addNewStory()">Tambah Cerita</button>\n    <div id="stories-list"></div>\n    <button id="logout-button" onclick="logoutUser()" style="display: none;">Logout</button>\n  ',function(){const n=localStorage.getItem("token");if(!n)return alert("Login dulu"),void(location.hash="#login");fetch("https://story-api.dicoding.dev/v1/stories",{headers:{Authorization:`Bearer ${n}`}}).then((n=>n.json())).then((n=>{var e;n.error?alert("Gagal mengambil cerita"):(e=n.listStory,document.getElementById("stories-list").innerHTML=e.map((n=>`\n    <div style="padding:10px; margin-bottom:10px; background:#f9f9f9;">\n      <h3>${n.name}</h3>\n      <p>${n.description}</p>\n      <img src="${n.photoUrl}" style="max-width:200px;" alt="story">\n      <p>Lat: ${n.lat??"-"}, Lon: ${n.lon??"-"}</p>\n    </div>\n  `)).join(""))})).catch((n=>alert("Error: "+n)))}(),function(){const n=localStorage.getItem("token"),e=document.getElementById("logout-button"),t=document.querySelector('nav a[href="#login"]'),o=document.querySelector('nav a[href="#register"]');e&&(e.style.display=n?"inline-block":"none"),t&&(t.style.display=n?"none":"inline-block"),o&&(o.style.display=n?"none":"inline-block")}()}function x(){y.innerHTML='\n    <h2>Tambah Cerita</h2>\n    <form id="story-form">\n      <label>Deskripsi:</label>\n      <textarea id="story-description" required></textarea>\n\n      <label>Foto:</label>\n      <button type="button" onclick="triggerFileInput()">Pilih dari Perangkat</button>\n      <button type="button" onclick="startCamera()">Ambil dari Kamera</button>\n\n      <div id="camera-container" style="display:none;">\n        <video id="video" width="320" height="240" autoplay></video>\n        <button type="button" onclick="capturePhoto()">Ambil Foto</button>\n        <canvas id="canvas" style="display:none;"></canvas>\n      </div>\n\n      <input type="file" id="story-photo" accept="image/*" style="display:none;" />\n      <input type="hidden" id="story-photo-base64" />\n\n      <input type="hidden" id="story-lat" name="lat" />\n      <input type="hidden" id="story-lon" name="lon" />\n      <div id="map" style="height:300px;margin-top:10px;"></div>\n\n      <button type="submit">Kirim Cerita</button>\n    </form>\n  ',function(){const n=document.getElementById("map"),e=L.map(n).setView([-2.5,117],4),t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}),o=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd"});t.addTo(e);const r={OpenStreetMap:t,"CartoDB Positron":o,"CartoDB Dark":a};let i;L.control.layers(r).addTo(e),navigator.geolocation&&navigator.geolocation.getCurrentPosition((n=>{const t=n.coords.latitude,o=n.coords.longitude;e.setView([t,o],13),document.getElementById("story-lat").value=t.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i=L.marker([t,o]).addTo(e).bindPopup("Lokasi Anda").openPopup()}),(()=>{alert("Tidak bisa mendapatkan lokasi.")})),e.on("click",(function(n){const{lat:t,lng:o}=n.latlng;document.getElementById("story-lat").value=t.toFixed(6),document.getElementById("story-lon").value=o.toFixed(6),i?i.setLatLng([t,o]):i=L.marker([t,o]).addTo(e),i.bindPopup(`Lokasi dipilih:<br>${t.toFixed(6)}, ${o.toFixed(6)}`).openPopup()}))}(),document.getElementById("story-form").addEventListener("submit",(function(n){n.preventDefault();const e=localStorage.getItem("token"),t=document.getElementById("story-description").value,o=document.getElementById("story-photo"),a=document.getElementById("story-photo-base64").value,r=document.getElementById("story-lat").value,i=document.getElementById("story-lon").value,s=new FormData;if(s.append("description",t),o.files.length>0)s.append("photo",o.files[0]);else{if(!a)return void alert("Silakan pilih atau ambil foto");{const n=function(n){const e=n.split(";base64,"),t=e[0].split(":")[1],o=atob(e[1]),a=[];for(let n=0;n<o.length;n++)a.push(o.charCodeAt(n));return new Blob([new Uint8Array(a)],{type:t})}(a);s.append("photo",n,"camera-photo.png")}}r&&i&&(s.append("lat",r),s.append("lon",i)),fetch("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:s}).then((n=>n.json())).then((n=>{n.error?alert("Gagal mengirim!"):(alert("Cerita berhasil dikirim!"),v())})).catch((n=>alert("Error: "+n)))}))}window.addEventListener("hashchange",b),b(),"serviceWorker"in navigator&&"PushManager"in window&&navigator.serviceWorker.register("service-worker.js").then((async function(n){if(console.log("Service Worker terdaftar:",n),"granted"===await Notification.requestPermission()){if(!await n.pushManager.getSubscription()){const e=function(n){const e=(n+"=".repeat(1)).replace(/\-/g,"+").replace(/_/g,"/"),t=atob(e);return Uint8Array.from([...t].map((n=>n.charCodeAt(0))))}("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"),t=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e});console.log("Berhasil subscribe:",JSON.stringify(t))}}else console.warn("Notifikasi tidak diizinkan.")})).catch(console.error),window.addNewStory=function(){document.startViewTransition?document.startViewTransition((()=>x())):x()},window.logoutUser=function(){localStorage.removeItem("token"),location.hash="login"},window.triggerFileInput=function(){document.getElementById("story-photo").click()},window.startCamera=function(){const n=document.getElementById("video");document.getElementById("camera-container").style.display="block",navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{n.srcObject=e,n.play()})).catch((n=>alert("Tidak bisa mengakses kamera: "+n)))},window.capturePhoto=function(){const n=document.getElementById("video"),e=document.getElementById("canvas"),t=document.getElementById("story-photo-base64");e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0,e.width,e.height);const o=e.toDataURL("image/png");t.value=o;const a=document.createElement("img");a.src=o,a.style.maxWidth="200px",document.getElementById("camera-container").appendChild(a),n.srcObject.getTracks().forEach((n=>n.stop())),n.style.display="none"}})();